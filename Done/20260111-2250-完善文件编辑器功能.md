# 完善文件编辑器功能，在悬浮窗中打开后可以新建和移动文件

## 概述
当前文件编辑器功能在悬浮窗中打开后，无法直接在编辑器中新建文件或移动文件。用户需要在文件树中右键点击文件夹才能新建文件，移动文件需要通过重命名功能实现。本任务的目标是在悬浮窗的文件编辑器中添加新建文件和移动文件的功能，提升用户体验。

## 当前实现

### 文件编辑器窗口
文件编辑器通过 `FileEditorWindowController` 实现，位于 `/Volumes/Cache/codeeditAi/aiX/Views/Worktree/Components/Git/FileEditorWindowController.swift`。该控制器创建独立的窗口显示文件内容，使用 `CodeEditorView` 作为编辑器组件。

当前 `FileEditorWindowContent` 视图包含：
- 头部：显示文件路径
- 编辑器区域：显示和编辑文件内容
- 工具栏：包含保存和关闭按钮

### 文件浏览器
文件浏览器位于 `/Volumes/Cache/codeeditAi/aiX/Views/Files/` 目录下，包含：
- `FileBrowserViewModel.swift`：管理文件树状态和文件操作
- `FileBrowserSessionView.swift`：主界面视图
- `FileTreeView.swift`：文件树视图，支持右键菜单新建、重命名、删除文件
- `FileContentTabView.swift`：标签页视图，管理多个打开的文件
- `FileContentView.swift`：单个文件内容视图
- `FileInputDialog.swift`：文件/文件夹名称输入对话框

### 文件操作
`FileBrowserViewModel` 已实现以下文件操作：
- `createNewFile(parentPath:name:)`：新建文件
- `createNewFolder(parentPath:name:)`：新建文件夹
- `renameItem(oldPath:newName:)`：重命名文件/文件夹
- `deleteItem(path:)`：删除文件/文件夹
- `copyPathToClipboard(path:)`：复制路径到剪贴板
- `revealInFinder(path:)`：在 Finder 中显示

### 悬浮窗系统
悬浮窗通过 `FloatingPanelView` 实现，位于 `/Volumes/Cache/codeeditAi/aiX/Views/Components/FloatingPanelView.swift`。支持四种类型的悬浮窗：
- files：文件浏览器
- browser：浏览器
- task：任务管理
- git：Git 操作

## 流程图

```mermaid
flowchart TD
    A[用户打开文件编辑器] --> B[显示 FileEditorWindowContent]
    B --> C{用户需要新建/移动文件}
    C -->|当前实现| D[切换到文件浏览器]
    D --> E[右键点击文件夹]
    E --> F[选择新建/重命名]
    F --> G[完成操作]
    C -->|期望实现| H[在编辑器工具栏添加按钮]
    H --> I[点击新建文件按钮]
    I --> J[弹出文件名输入对话框]
    J --> K[输入文件名并确认]
    K --> L[创建文件并打开]
    H --> M[点击移动文件按钮]
    M --> N[弹出文件选择器]
    N --> O[选择目标位置]
    O --> P[移动文件]
```

## 方案

### 方案一：在编辑器工具栏添加新建和移动按钮
**优点**：
- 操作直观，用户可以直接在编辑器中完成操作
- 不需要切换到文件浏览器
- 与现有工具栏风格一致

**缺点**：
- 需要修改 `FileEditorWindowContent` 的工具栏
- 需要获取当前文件的父目录路径
- 移动文件需要实现文件选择器

**实现细节**：
1. 在 `FileEditorWindowContent` 的工具栏中添加"新建文件"和"移动文件"按钮
2. 新建文件时：
   - 获取当前文件的父目录路径
   - 显示 `FileInputDialog` 对话框
   - 调用 `FileBrowserViewModel` 的 `createNewFile` 方法
   - 创建成功后打开新文件
3. 移动文件时：
   - 显示文件选择器（可使用 `NSOpenPanel`）
   - 用户选择目标文件夹
   - 调用文件移动操作
   - 更新当前文件路径和窗口标题

### 方案二：在编辑器添加右键菜单
**优点**：
- 不占用工具栏空间
- 符合 macOS 用户习惯

**缺点**：
- 需要用户右键点击才能发现功能
- 不够直观

### 方案三：在编辑器头部添加快捷操作按钮
**优点**：
- 操作位置明显
- 不占用工具栏空间

**缺点**：
- 需要修改头部布局
- 可能与文件路径显示冲突

### 推荐方案：方案一
方案一最符合用户期望，操作直观且易于发现。具体实现步骤如下：

1. **修改 FileEditorWindowContent 工具栏**
   - 添加"新建文件"按钮（图标：`doc.badge.plus`）
   - 添加"移动文件"按钮（图标：`folder.badge.gearshape`）

2. **实现新建文件功能**
   - 获取当前文件的父目录路径
   - 显示 `FileInputDialog` 对话框
   - 使用 `FileService` 创建文件
   - 创建成功后打开新文件

3. **实现移动文件功能**
   - 使用 `NSOpenPanel` 选择目标文件夹
   - 使用 `FileService` 移动文件
   - 更新当前文件路径和窗口标题
   - 重新加载文件内容

4. **添加 FileService 方法**
   - 如果 `FileService` 没有移动文件的方法，需要添加

## 相关代码位置

- [FileEditorWindowController.swift](vscode://file/Volumes/Cache/codeeditAi/aiX/Views/Worktree/Components/Git/FileEditorWindowController.swift)
- [FileBrowserViewModel.swift](vscode://file/Volumes/Cache/codeeditAi/aiX/Views/Files/FileBrowserViewModel.swift)
- [FileInputDialog.swift](vscode://file/Volumes/Cache/codeeditAi/aiX/Views/Files/Components/FileInputDialog.swift)
- [FloatingPanelView.swift](vscode://file/Volumes/Cache/codeeditAi/aiX/Views/Components/FloatingPanelView.swift)

## 代码错误测试
修改代码后，需要运行以下命令检查代码错误：
```bash
cd /Volumes/Cache/codeeditAi/worktrees/2250-完善文件编辑器
xcodebuild -scheme aiX -configuration Debug clean build
```

## 验证流程
1. 打开文件编辑器悬浮窗
2. 点击工具栏的"新建文件"按钮
3. 输入文件名并确认
4. 验证新文件是否创建成功并自动打开
5. 点击工具栏的"移动文件"按钮
6. 选择目标文件夹
7. 验证文件是否成功移动到目标位置
8. 验证窗口标题和文件路径是否更新

## 任务总结与结论
本任务通过在文件编辑器悬浮窗的工具栏中添加"新建文件"和"移动文件"按钮，让用户可以在编辑器中直接完成文件操作，无需切换到文件浏览器。这将提升用户体验，使文件编辑器功能更加完善。

## 任务耗时
- 任务开始时间：2250
- 任务结束时间：待定
- 任务总耗时：待定